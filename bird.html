<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Pro</title>

<style>
body {
    margin: 0;
    background: linear-gradient(#87ceeb, #ffffff);
    font-family: Arial, sans-serif;
    text-align: center;
}

h2 {
    margin: 10px 0;
}

canvas {
    display: block;
    margin: auto;
}

/* Boutons */
button {
    margin: 8px;
    padding: 10px 22px;
    font-size: 16px;
    border: none;
    border-radius: 10px;
    color: white;
}

#replayBtn {
    background: #ff5252;
    display: none;
}

#fullscreenBtn {
    background: #333;
}
</style>
</head>

<body>

<h2>ğŸ¦ Flappy Bird</h2>

<canvas id="game"></canvas>

<button id="fullscreenBtn">ğŸ”³ Plein Ã©cran</button>
<button id="replayBtn">ğŸ”„ Rejouer</button>

<script>
/* ===================== SETUP ===================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const replayBtn = document.getElementById("replayBtn");
const fullscreenBtn = document.getElementById("fullscreenBtn");

function resizeCanvas() {
    if (document.fullscreenElement) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    } else {
        canvas.width = Math.min(window.innerWidth, 400);
        canvas.height = 500;
    }
}
resizeCanvas();
document.addEventListener("fullscreenchange", resizeCanvas);

/* ===================== FULLSCREEN ===================== */
fullscreenBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) {
        canvas.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
});

/* ===================== AUDIO ===================== */
const crashSound = new Audio(
"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA="
);

/* ===================== GAME DATA ===================== */
let bird, pipes, clouds, score, bestScore, state;

bestScore = localStorage.getItem("bestScore") || 0;

function randomTop() {
    return Math.random() * 200 + 50;
}

function resetGame() {
    bird = { x: 80, y: 200, r: 15, v: 0 };
    pipes = [{ x: canvas.width, top: randomTop() }];
    clouds = [
        { x: 50, y: 80 },
        { x: 200, y: 130 },
        { x: 340, y: 60 }
    ];
    score = 0;
    state = "start"; // start | play | over
    replayBtn.style.display = "none";
}
resetGame();

/* ===================== CONTROLS ===================== */
function flap() {
    if (state === "start") state = "play";
    if (state === "play") bird.v = -8;
}

canvas.addEventListener("click", flap);
canvas.addEventListener("touchstart", flap);

replayBtn.onclick = resetGame;

/* ===================== DRAW ===================== */
function drawBird() {
    ctx.beginPath();
    ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI * 2);
    ctx.fillStyle = "yellow";
    ctx.shadowColor = "orange";
    ctx.shadowBlur = 10;
    ctx.fill();
    ctx.shadowBlur = 0;
}

function drawPipes() {
    ctx.fillStyle = "#2ecc71";
    pipes.forEach(p => {
        ctx.fillRect(p.x, 0, 60, p.top);
        ctx.fillRect(p.x, p.top + 160, 60, canvas.height);
    });
}

function drawClouds() {
    ctx.fillStyle = "rgba(255,255,255,0.8)";
    clouds.forEach(c => {
        ctx.beginPath();
        ctx.arc(c.x, c.y, 20, 0, Math.PI * 2);
        ctx.arc(c.x + 25, c.y + 5, 25, 0, Math.PI * 2);
        ctx.fill();
    });
}

/* ===================== GAME LOOP ===================== */
function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // DÃ©cor animÃ©
    clouds.forEach(c => {
        c.x -= 0.3;
        if (c.x < -60) c.x = canvas.width + 60;
    });

    if (state === "play") {
        bird.v += 0.5;
        bird.y += bird.v;

        pipes.forEach(p => p.x -= 2);

        if (pipes[0].x < -60) {
            pipes.shift();
            pipes.push({ x: canvas.width, top: randomTop() });
            score++;
        }

        pipes.forEach(p => {
            if (
                bird.x + bird.r > p.x &&
                bird.x - bird.r < p.x + 60 &&
                (bird.y - bird.r < p.top ||
                 bird.y + bird.r > p.top + 160)
            ) endGame();
        });

        if (bird.y < 0 || bird.y > canvas.height) endGame();
    }

    drawClouds();
    drawPipes();
    drawBird();

    ctx.fillStyle = "#000";
    ctx.fillText("Score : " + score, 10, 20);
    ctx.fillText("Best : " + bestScore, 10, 40);

    if (state === "start") {
        ctx.fillText("TAPE POUR COMMENCER", canvas.width / 2 - 80, canvas.height / 2);
    }

    if (state === "over") {
        ctx.fillStyle = "red";
        ctx.fillText("GAME OVER", canvas.width / 2 - 40, canvas.height / 2);
    }

    requestAnimationFrame(update);
}

function endGame() {
    if (state !== "over") {
        state = "over";
        crashSound.play();
        replayBtn.style.display = "inline-block";

        if (score > bestScore) {
            bestScore = score;
            localStorage.setItem("bestScore", bestScore);
        }
    }
}

update();
</script>

</body>
</html>
